---
title: "Donor Database Cleanup"
excerpt: Showcasing SQL methods for deduplication, relational modeling, and enforcing data consistency across donor and donation records.
layout: default
author_profile: false
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio – Donor Database Work Sample</title>
<body>

<header>
  <h1 class="header">Jennifer Haliewicz – Data Portfolio</h1>
  <h2>Work Sample: Cleaning & Normalizing a Mock Donor Database</h2>
</header>

<main>
  <aside>
    <h2>Project Overview</h2>
    <p>This work sample demonstrates my ability to clean and normalize messy donor data, design a proper schema, and implement SQL solutions to enforce data integrity and consistency.</p>

    <h2>Skills Highlighted</h2>
    <ul>
      <li>Data Cleaning & Normalization</li>
      <li>SQL / Database Design</li>
      <li>Data Quality Management</li>
      <li>Schema Design & Relationships</li>
      <li>Portfolio-ready Documentation</li>
    </ul>
  </aside>

  <section>
    <h2>1. Generate Mock Data with Common Data-Quality Issues</h2>
    <p>I created a synthetic donor dataset containing realistic problems often encountered in nonprofit CRMs, including:</p>
    <ul>
      <li>Duplicate donor records</li>
      <li>Non-uniform data entry such as:
        <ul>
          <li>Inconsistent address and phone formats</li>
          <li>Varying capitalization of names</li>
          <li>Mixed date formats</li>
        </ul>
      </li>
      <li>Structural issue:
        <ul>
          <li>The database creates a new donor record for each donation instead of maintaining a one-to-many relationship between donors and donations</li>
        </ul>
      </li>
    </ul>

    <h2>2. Cleaning and Normalizing</h2>

    <h3>a. Schema Design</h3>
    <p>Created a normalized database structure with the goal of separating donor records from donation records to ensure a one-to-many relationship:</p>
    <ul>
      <li><strong>Donors Table:</strong> Stores unique donor information.</li>
      <li><strong>Donations Table:</strong> Stores donation records linked to donors via <code>donor_id</code>.</li>
    </ul>

    <pre>
CREATE TABLE donors (
    donor_id SERIAL PRIMARY KEY,
    first_name VARCHAR(225) NOT NULL,
    last_name VARCHAR(225) NOT NULL,
    email VARCHAR(225),
    address VARCHAR(225) NOT NULL,
    city VARCHAR(225) NOT NULL,
    phone VARCHAR(20),
    state VARCHAR(225) NOT NULL
);

CREATE TABLE donations (
    donation_id SERIAL PRIMARY KEY,
    donor_id INT NOT NULL,
    donation_amount DECIMAL(10,2),
    donation_date DATE,
    campaign VARCHAR(225),
    donation_type VARCHAR(225),
    FOREIGN KEY (donor_id) REFERENCES donors(donor_id)
);
    </pre>

    <h3>b. Populating the Donors Table</h3>
    <p>To populate donors while avoiding duplicates, I selected unique donors using their email address as a differentiator and chose the most recent donation (using <code>donation_date</code>) to ensure accuracy.</p>

    <pre>
INSERT INTO donors (first_name, last_name, email, address, city, phone, state)
SELECT first_name, last_name, email, address, city, phone, state
FROM (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY address ORDER BY donation_date DESC) AS rn
    FROM donors_donations
) AS ranked
WHERE rn = 1;
    </pre>

    <h3>c. Linking Donations to Donors</h3>
    <p>To relate donation records to their corresponding donors I did the following:</p>
    <ul>
      <li>Added a <code>donor_id</code> column to the donors table that is automatically generated upon new entry.</li>
      <li>Updated the donations table entries by joining to the donors table on <code>first_name</code>, <code>last_name</code>, and <code>email</code>.</li>
    </ul>

    <pre>
ALTER TABLE donors_donations ADD COLUMN donor_id INT;

UPDATE donors_donations dd
SET donor_id = d.donor_id
FROM donors d
WHERE dd.first_name = d.first_name
  AND dd.last_name = d.last_name
  AND dd.email = d.email;
    </pre>

    <h3>d. Cleaning and Standardizing Dates</h3>
    <pre>
UPDATE donors_donations
SET donation_date = 
    CASE
        WHEN donation_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(REPLACE(donation_date,'/','-'), 'MM-DD-YYYY')
        WHEN donation_date ~ '^\d{2}-[A-Za-z]{3}-\d{4}$' THEN TO_DATE(donation_date, 'DD-Mon-YYYY')
        ELSE donation_date::DATE
    END;
    </pre>

    <h3>e. Populating the Donations Table</h3>
    <pre>
INSERT INTO donations (donor_id, donation_amount, donation_date, campaign, donation_type)
SELECT donor_id, donation_amount, donation_date, campaign, donation_type
FROM donors_donations;
    </pre>

    <h3>f. Standardizing Address Abbreviations</h3>
    <pre>
UPDATE donors
SET address = REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
               REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
               REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(address,
               'Drive', 'Dr'),
               'Road', 'Rd'),
               'Street', 'St'),
               'Avenue', 'Ave'),
               'Trail', 'Trl'),
               'Expressway', 'Expy'),
               'Extension', 'Ext'),
               'Parkway', 'Pkwy'),
               'Station', 'Sta'),
               'Loop', 'Loop'),
               'Causeway', 'Cswy'),
               'Throughway', 'Thwy'),
               'Place', 'Pl'),
               'Bridge', 'Brg'),
               'Mount', 'Mt'),
               'Mountain', 'Mtn'),
               'Terrace', 'Ter'),
               'Village', 'Vlg'),
               'Haven', 'Hvn'),
               'Island', 'Is'),
               'Motorway', 'Mtwy');
    </pre>

    <h3>g. Formatting Phone Numbers</h3>
    <pre>
UPDATE donors
SET phone = CASE
    WHEN phone ~ '^\d{10}$' THEN
        REGEXP_REPLACE(phone, '(\d{3})(\d{3})(\d{4})', '(\1) \2-\3')
    WHEN phone ~ '^\d{7}$' THEN
        REGEXP_REPLACE(phone, '(\d{3})(\d{4})', '\1-\2')
    ELSE
        phone
END;
    </pre>

    <h3>h. Normalizing Name Capitalization</h3>
    <pre>
UPDATE donors
SET
    first_name = INITCAP(LOWER(first_name)),
    last_name = INITCAP(LOWER(last_name));
    </pre>

    <h2>3. Next Steps / Best Practices</h2>
    <ul>
      <li>Use appropriate data types for dates and numeric fields.</li>
      <li>Enforce consistent formats for phone numbers, postal codes, and other fields using constraints or regex.</li>
      <li>Implement stored procedures or triggers to automate data cleaning on new entries.</li>
    </ul>

    <h2>Database Schema</h2>
    
    <p>Original data in one table</p>
    <img src="https://www.jenniferhaliewicz.com/files/old_schema.png" height=250px>
    <p>Normalized tables with auto-incremented IDs:</p>
    <img src="https://www.jenniferhaliewicz.com/files/new%20schema.png" width=400px>
    
    <h2>Relationships</h2>
    <p>Each donor can have multiple donations (1-to-many relationship):</p>
    <div class="diagram">
      <div class="box">Donors<br>(donor_id)</div>
      <div class="arrow">──&gt;</div>
      <div class="box">Donations<br>(donor_id)</div>
    </div>

  </section>
</main>

<footer>
  © 2025 Jennifer Haliewicz | <a href="https://www.jenniferhaliewicz.com">jenniferhaliewicz.com</a>
</footer>

</body>
</html>
